<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced Web OS</title>
    <style>
        /* Base OS Styling */
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: #1e293b; }
        #desktop { width: 100vw; height: 100vh; position: relative; }
        
        /* Icons */
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fill, 90px); gap: 20px; padding: 20px; }
        .icon { text-align: center; color: white; cursor: pointer; padding: 10px; border-radius: 8px; transition: 0.2s; }
        .icon:hover { background: rgba(255,255,255,0.15); }
        .icon-img { font-size: 40px; display: block; margin-bottom: 5px; }

        /* Windows */
        .window { 
            position: absolute; background: white; border: 1px solid #444; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); display: none; 
            flex-direction: column; border-radius: 8px; overflow: hidden; min-width: 300px;
        }
        .window-header { 
            background: #e2e8f0; padding: 8px 12px; cursor: move; 
            display: flex; justify-content: space-between; align-items: center; font-weight: 600;
        }
        .close-btn { background: #ef4444; border: none; color: white; border-radius: 50%; cursor: pointer; width: 22px; height: 22px; }
        .content { flex-grow: 1; overflow: auto; padding: 10px; position: relative; }

        /* Calculator Specific */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .calc-display { grid-column: span 4; background: #eee; padding: 10px; text-align: right; font-size: 1.5rem; margin-bottom: 5px; height: 50px; }
        .calc-btn { padding: 15px; border: 1px solid #ddd; cursor: pointer; background: #f9f9f9; }
        .calc-btn:hover { background: #e2e8f0; }

        /* Photos & Camera */
        .photo-gallery { display: grid; grid-template-columns: repeat(auto-fill, 100px); gap: 10px; }
        .photo-item { width: 100px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid #ccc; }
        video, canvas { width: 100%; border-radius: 4px; background: #000; }

        /* Taskbar */
        #taskbar { position: absolute; bottom: 0; width: 100%; height: 45px; background: rgba(15, 23, 42, 0.9); display: flex; align-items: center; padding: 0 15px; z-index: 1000; }
        #start-btn { background: #3b82f6; color: white; border: none; padding: 6px 15px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div id="desktop">
    <div class="icon-grid">
        <div class="icon" onclick="openApp('calc')"><span class="icon-img">üßÆ</span>Calc</div>
        <div class="icon" onclick="openApp('cam'); startCamera()"><span class="icon-img">üì∑</span>Camera</div>
        <div class="icon" onclick="openApp('photos'); loadPhotos()"><span class="icon-img">üñºÔ∏è</span>Photos</div>
        <div class="icon" onclick="openApp('game')"><span class="icon-img">üéÆ</span>Game</div>
        <div class="icon" onclick="openApp('files')"><span class="icon-img">üìÇ</span>Files</div>
    </div>

    <!-- Calculator App -->
    <div id="calc" class="window" style="width: 250px; top: 50px; left: 150px;">
        <div class="window-header"><span>Calculator</span><button class="close-btn" onclick="closeApp('calc')">x</button></div>
        <div class="content">
            <div id="calc-res" class="calc-display">0</div>
            <div class="calc-grid">
                <button class="calc-btn" onclick="calcInput('7')">7</button><button class="calc-btn" onclick="calcInput('8')">8</button><button class="calc-btn" onclick="calcInput('9')">9</button><button class="calc-btn" onclick="calcInput('/')">/</button>
                <button class="calc-btn" onclick="calcInput('4')">4</button><button class="calc-btn" onclick="calcInput('5')">5</button><button class="calc-btn" onclick="calcInput('6')">6</button><button class="calc-btn" onclick="calcInput('*')">*</button>
                <button class="calc-btn" onclick="calcInput('1')">1</button><button class="calc-btn" onclick="calcInput('2')">2</button><button class="calc-btn" onclick="calcInput('3')">3</button><button class="calc-btn" onclick="calcInput('-')">-</button>
                <button class="calc-btn" onclick="calcInput('0')">0</button><button class="calc-btn" onclick="calcClear()">C</button><button class="calc-btn" onclick="calcSolve()">=</button><button class="calc-btn" onclick="calcInput('+')">+</button>
            </div>
        </div>
    </div>

    <!-- Camera App -->
    <div id="cam" class="window" style="width: 400px; top: 100px; left: 450px;">
        <div class="window-header"><span>Camera</span><button class="close-btn" onclick="closeApp('cam')">x</button></div>
        <div class="content">
            <video id="webcam" autoplay playsinline></video>
            <button onclick="takePhoto()" style="width:100%; margin-top:10px; padding:10px; background:#10b981; color:white; border:none; border-radius:4px; cursor:pointer;">Capture Photo</button>
            <canvas id="cam-canvas" style="display:none;"></canvas>
        </div>
    </div>

    <!-- Photos App -->
    <div id="photos" class="window" style="width: 400px; height: 300px; top: 200px; left: 200px;">
        <div class="window-header"><span>My Photos</span><button class="close-btn" onclick="closeApp('photos')">x</button></div>
        <div id="photo-list" class="content photo-gallery">
            <!-- Photos appear here -->
        </div>
    </div>

    <!-- Simple Game (Clicker) -->
    <div id="game" class="window" style="width: 300px; top: 300px; left: 600px;">
        <div class="window-header"><span>Gold Clicker</span><button class="close-btn" onclick="closeApp('game')">x</button></div>
        <div class="content" style="text-align:center;">
            <h3>Gold: <span id="gold-count">0</span></h3>
            <div onclick="clickGold()" style="font-size:60px; cursor:pointer; user-select:none;">üí∞</div>
        </div>
    </div>

    <!-- File Explorer -->
    <div id="files" class="window" style="width: 400px; top: 50px; left: 50px;">
        <div class="window-header"><span>Files</span><button class="close-btn" onclick="closeApp('files')">x</button></div>
        <div class="content">
            <p>System Files:</p>
            <ul>
                <li>photo_vault.db</li>
                <li>os_config.json</li>
                <li>save_game.sav</li>
            </ul>
        </div>
    </div>

    <div id="taskbar"><button id="start-btn">Menu</button></div>
</div>

<script>
    /* Window Management */
    function openApp(id) { document.getElementById(id).style.display = 'flex'; }
    function closeApp(id) { document.getElementById(id).style.display = 'none'; }

    /* Calculator Logic */
    let calcStr = "";
    function calcInput(val) { calcStr += val; document.getElementById('calc-res').innerText = calcStr; }
    function calcClear() { calcStr = ""; document.getElementById('calc-res').innerText = "0"; }
    function calcSolve() { try { calcStr = eval(calcStr).toString(); document.getElementById('calc-res').innerText = calcStr; } catch { calcStr = "Error"; } }

    /* Camera & Photos Logic */
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('webcam').srcObject = stream;
        } catch (e) { alert("Camera access denied or unavailable."); }
    }

    function takePhoto() {
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('cam-canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        const imgData = canvas.toDataURL('image/png'); // Convert to string
        let photos = JSON.parse(localStorage.getItem('os_photos') || "[]");
        photos.push(imgData);
        localStorage.setItem('os_photos', JSON.stringify(photos));
        alert("Photo Saved!");
    }

    function loadPhotos() {
        const list = document.getElementById('photo-list');
        list.innerHTML = "";
        let photos = JSON.parse(localStorage.getItem('os_photos') || "[]");
        photos.forEach(src => {
            const img = document.createElement('img');
            img.src = src;
            img.className = "photo-item";
            list.appendChild(img);
        });
    }

    /* Game Logic */
    let gold = parseInt(localStorage.getItem('os_gold') || "0");
    document.getElementById('gold-count').innerText = gold;
    function clickGold() {
        gold++;
        document.getElementById('gold-count').innerText = gold;
        localStorage.setItem('os_gold', gold);
    }

    /* Simple Dragging Logic */
    let dragItem = null;
    let offset = {x:0, y:0};
    document.addEventListener('mousedown', e => {
        if(e.target.closest('.window-header')) {
            dragItem = e.target.closest('.window');
            offset.x = e.clientX - dragItem.offsetLeft;
            offset.y = e.clientY - dragItem.offsetTop;
            dragItem.style.zIndex = 100;
        }
    });
    document.addEventListener('mousemove', e => {
        if(dragItem) {
            dragItem.style.left = (e.clientX - offset.x) + 'px';
            dragItem.style.top = (e.clientY - offset.y) + 'px';
        }
    });
    document.addEventListener('mouseup', () => dragItem = null);
</script>

</body>
</html>